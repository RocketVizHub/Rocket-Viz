<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <title>Rocket Viz - Aperçu</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- <style>
        body {
            padding-top: 56px;
        }

        @media (min-width: 768px) {
            body {
                padding-top: 70px;
            }
        }
    </style> -->
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="index.html">Rocket Viz</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="stats.html">Stats</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="global_stats.html">Aperçu</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Table Section -->
    <div class="container mt-3">
        <h1> Aperçu de la partie </h1>

        <!-- Create an empty table with an id -->
        <table id="playerStatsTable" border="1" class="table table-bordered table-striped">
            <thead class="thead-dark">
                <tr>
                    <th></th>
                    <th>Score</th>
                    <th>Goals</th>
                    <th>Assists</th>
                    <th>Saves</th>
                    <th>Shots</th>
                </tr>
            </thead>
            <tbody>
                <!-- Table body will be populated using D3 -->
            </tbody>
        </table>
    </div>
    

    </table>

    <script>
        d3.json("utils/replay03.json").then(function(data) {
            console.log(data.properties);

            var scoreTeam0;
            var scoreTeam1;

            if (typeof data.properties.Team0Score === "undefined") scoreTeam0 = 0;
            else scoreTeam0 = data.properties.Team0Score;
            if (typeof data.properties.Team1Score === "undefined") scoreTeam1 = 0;
            else scoreTeam1 = data.properties.Team1Score;

            
            var team0Stats = data.properties.PlayerStats.filter(player => player.Team === 0);
            var team1Stats = data.properties.PlayerStats.filter(player => player.Team === 1);

            
            // Add element at the beginning of the array, that is the team score
            team0Stats.unshift(scoreTeam0);
            team1Stats.unshift(scoreTeam1);
            var teamsStats = [team0Stats,team1Stats];

            var table = d3.select("#playerStatsTable");

            var tbody = table.select('tbody');

            function displayPlayerStats() {
                var rows = d3.select("#playerStatsTable")
                    .select('tbody')
                    .selectAll('tr')
                    .data(teamsStats)
                    .enter()

                var rows2 = rows.selectAll("tr")
                    .data(function (d) {    // joins inner array of each row
                        return d;
                    })
                    .enter()
                    .append('tr');

                    rows2.append('td')
                    .text(function(d) {
                        if (typeof d === "number" && Number.isInteger(d)) {
                            d3.select(this)
                                .classed('special-column', true)
                                .attr('colspan', 6)
                                .style('font-weight', 'bold')
                                .classed('text-light', true)
                                .classed('bg-primary', d === scoreTeam0)
                                .classed('bg-secondary', d === scoreTeam1);
                            return d;
                        } else {
                            return d.Name;
                        }
                    });

                    rows2.each(function(d) {
                        if (typeof d.Score !== "undefined") {
                            d3.select(this).append('td').text(d.Score);
                        }
                    });
                    rows2.each(function(d) {
                        if (typeof d.Goals !== "undefined") {
                            d3.select(this).append('td').text(d.Goals);
                        }
                    });
                    rows2.each(function(d) {
                        if (typeof d.Assists !== "undefined") {
                            d3.select(this).append('td').text(d.Assists);
                        }
                    });
                    rows2.each(function(d) {
                        if (typeof d.Saves !== "undefined") {
                            d3.select(this).append('td').text(d.Saves);
                        }
                    });
                    rows2.each(function(d) {
                        if (typeof d.Shots !== "undefined") {
                            d3.select(this).append('td').text(d.Shots);
                        }
                    });
            }

            displayPlayerStats();
        });
    </script>
</body>